<!-- Interactive Variant Preview Modal -->
<div id="variant-preview-modal" class="modal modal-open" style="display: none;">
    <div class="modal-box w-11/12 max-w-7xl h-5/6 relative">
        <!-- Modal Header -->
        <div class="flex items-center justify-between mb-6">
            <h3 class="font-bold text-2xl">ðŸŽ¯ Interactive Variant Choice</h3>
            <button class="btn btn-sm btn-circle" onclick="closeVariantModal()">âœ•</button>
        </div>
        
        <!-- Variant Information -->
        <div id="variant-info" class="mb-6">
            <h4 class="text-xl font-semibold mb-2" id="variant-title">Grid System Choice</h4>
            <p class="text-gray-600 mb-4" id="variant-description">Choose between different approaches for your game mechanics</p>
            
            <!-- Educational Context (for Arcade Academy) -->
            <div id="educational-context" class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-4" style="display: none;">
                <div class="flex items-center mb-2">
                    <img src="/static/assets/mascots/professor-pixel-transparent.png" class="w-8 h-8 mr-2" alt="Professor Pixel">
                    <span class="font-semibold text-purple-700">Professor Pixel Says:</span>
                </div>
                <p id="educational-insight" class="text-purple-600 text-sm"></p>
            </div>
        </div>
        
        <!-- Split-Screen Preview -->
        <div class="flex flex-col lg:flex-row gap-6 h-4/5">
            <!-- Choice A Preview -->
            <div class="flex-1 border rounded-lg p-4 bg-green-50" id="choice-a-panel">
                <div class="flex items-center justify-between mb-4">
                    <h5 class="font-bold text-lg text-green-700" id="choice-a-title">Option A: Square Grid</h5>
                    <div class="flex items-center">
                        <span class="badge badge-success mr-2" id="choice-a-difficulty">Easier</span>
                        <input type="radio" name="variant-choice" value="a" class="radio radio-success" checked>
                    </div>
                </div>
                
                <!-- Visual Hint -->
                <div class="bg-white p-3 rounded mb-4">
                    <div class="text-2xl mb-2" id="choice-a-visual">ðŸŸ¦</div>
                    <p class="text-sm text-gray-600" id="choice-a-hint">Orderly grid of square tiles, like Tetris</p>
                </div>
                
                <!-- Code Preview -->
                <div class="bg-gray-900 text-green-400 p-4 rounded font-mono text-sm overflow-auto h-40">
                    <pre id="choice-a-code"># Square grid system
grid_size = 32
x_pos = col * grid_size
y_pos = row * grid_size</pre>
                </div>
                
                <!-- Educational Notes -->
                <div class="mt-4">
                    <p class="text-sm text-green-600" id="choice-a-notes">Square grids use simple x,y coordinates</p>
                </div>
            </div>
            
            <!-- Choice B Preview -->
            <div class="flex-1 border rounded-lg p-4 bg-orange-50" id="choice-b-panel">
                <div class="flex items-center justify-between mb-4">
                    <h5 class="font-bold text-lg text-orange-700" id="choice-b-title">Option B: Hexagonal Grid</h5>
                    <div class="flex items-center">
                        <span class="badge badge-warning mr-2" id="choice-b-difficulty">Harder</span>
                        <input type="radio" name="variant-choice" value="b" class="radio radio-warning">
                    </div>
                </div>
                
                <!-- Visual Hint -->
                <div class="bg-white p-3 rounded mb-4">
                    <div class="text-2xl mb-2" id="choice-b-visual">â¬¡</div>
                    <p class="text-sm text-gray-600" id="choice-b-hint">Honeycomb pattern, like Civilization</p>
                </div>
                
                <!-- Code Preview -->
                <div class="bg-gray-900 text-orange-400 p-4 rounded font-mono text-sm overflow-auto h-40">
                    <pre id="choice-b-code"># Hexagonal grid system
import math
hex_size = 32
x_pos = col * hex_size * 1.5
y_pos = row * hex_size * math.sqrt(3)</pre>
                </div>
                
                <!-- Educational Notes -->
                <div class="mt-4">
                    <p class="text-sm text-orange-600" id="choice-b-notes">Hexagonal grids require trigonometry</p>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="modal-action">
            <button class="btn btn-ghost" onclick="closeVariantModal()">Skip Choice</button>
            <button class="btn btn-primary" onclick="applyVariantChoice()">
                ðŸš€ Apply Choice & Continue
            </button>
        </div>
    </div>
</div>

<!-- Variant Alert Component -->
<div id="variant-alert" class="alert alert-info shadow-lg mb-4" style="display: none;">
    <div>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
            <h3 class="font-bold">ðŸŽ¯ Interactive Choice Detected!</h3>
            <div class="text-xs">We found <span id="variant-count">3</span> decisions you can experiment with in your game.</div>
        </div>
    </div>
    <div class="flex-none">
        <button class="btn btn-sm" onclick="showVariantPreview()">Explore Choices</button>
        <button class="btn btn-sm btn-ghost" onclick="hideVariantAlert()">Continue</button>
    </div>
</div>

<script>
// Global variant system state
let currentVariants = [];
let currentVariantIndex = 0;
let selectedChoices = {};

function showVariantAlert(variants) {
    currentVariants = variants || [];
    document.getElementById('variant-count').textContent = currentVariants.length;
    document.getElementById('variant-alert').style.display = 'block';
}

function hideVariantAlert() {
    document.getElementById('variant-alert').style.display = 'none';
}

function showVariantPreview(variantIndex = 0) {
    if (!currentVariants.length) return;
    
    currentVariantIndex = variantIndex;
    const variant = currentVariants[currentVariantIndex];
    
    // Populate variant information
    document.getElementById('variant-title').textContent = variant.name;
    document.getElementById('variant-description').textContent = variant.description;
    
    // Show educational context if available (Arcade Academy)
    const educationalContext = document.getElementById('educational-context');
    if (variant.educational_value) {
        document.getElementById('educational-insight').textContent = variant.educational_value;
        educationalContext.style.display = 'block';
    } else {
        educationalContext.style.display = 'none';
    }
    
    // Populate choice A
    const choiceA = variant.choices[0];
    document.getElementById('choice-a-title').textContent = `Option A: ${choiceA.name}`;
    document.getElementById('choice-a-difficulty').textContent = choiceA.difficulty || 'Same';
    document.getElementById('choice-a-difficulty').className = `badge ${getDifficultyBadgeClass(choiceA.difficulty)}`;
    document.getElementById('choice-a-visual').textContent = getVisualHint(choiceA.id);
    document.getElementById('choice-a-hint').textContent = choiceA.description;
    document.getElementById('choice-a-code').textContent = choiceA.code_snippet || '// Code preview';
    document.getElementById('choice-a-notes').textContent = choiceA.educational_notes || '';
    
    // Populate choice B
    const choiceB = variant.choices[1];
    if (choiceB) {
        document.getElementById('choice-b-title').textContent = `Option B: ${choiceB.name}`;
        document.getElementById('choice-b-difficulty').textContent = choiceB.difficulty || 'Same';
        document.getElementById('choice-b-difficulty').className = `badge ${getDifficultyBadgeClass(choiceB.difficulty)}`;
        document.getElementById('choice-b-visual').textContent = getVisualHint(choiceB.id);
        document.getElementById('choice-b-hint').textContent = choiceB.description;
        document.getElementById('choice-b-code').textContent = choiceB.code_snippet || '// Code preview';
        document.getElementById('choice-b-notes').textContent = choiceB.educational_notes || '';
    }
    
    // Show modal
    hideVariantAlert();
    document.getElementById('variant-preview-modal').style.display = 'block';
}

function closeVariantModal() {
    document.getElementById('variant-preview-modal').style.display = 'none';
}

function applyVariantChoice() {
    const selectedChoice = document.querySelector('input[name="variant-choice"]:checked').value;
    const variant = currentVariants[currentVariantIndex];
    
    // Store the choice
    selectedChoices[variant.id] = selectedChoice;
    
    // Check if there are more variants to show
    if (currentVariantIndex < currentVariants.length - 1) {
        showVariantPreview(currentVariantIndex + 1);
    } else {
        // All choices made, apply them
        closeVariantModal();
        applyAllVariantChoices();
    }
}

function applyAllVariantChoices() {
    // Send choices to backend to regenerate with selected variants
    console.log('Selected variant choices:', selectedChoices);
    
    // Show success message
    showNotification('ðŸŽ¯ Variant choices applied! Your game has been updated.', 'success');
    
    // Update feature flags display
    updateFeatureFlagsDisplay();
}

function getDifficultyBadgeClass(difficulty) {
    switch (difficulty?.toLowerCase()) {
        case 'easier': return 'badge-success';
        case 'harder': return 'badge-error';
        case 'same': default: return 'badge-warning';
    }
}

function getVisualHint(choiceId) {
    const hints = {
        'a_square': 'ðŸŸ¦',
        'b_hexagonal': 'â¬¡',
        'a_turn_based': 'â¸ï¸',
        'b_realtime': 'âš¡',
        'a_discrete': 'ðŸ“',
        'b_continuous': 'ðŸƒ',
        'a_simple': 'ðŸŽ¯',
        'b_pathfinding': 'ðŸ§ '
    };
    return hints[choiceId] || 'ðŸŽ®';
}

function updateFeatureFlagsDisplay() {
    // Update any feature flags UI components
    // This would connect to the features.toml system
}

function showNotification(message, type = 'info') {
    // Create and show a notification
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} fixed top-4 right-4 z-50 max-w-sm`;
    notification.innerHTML = `
        <div>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto-remove after 3 seconds
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>