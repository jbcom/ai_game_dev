<!-- Professor Pixel Teaching Modal Component -->
<div id="professor-pixel-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
    <div class="relative max-w-4xl w-full mx-4">
        <!-- Professor Pixel Avatar -->
        <div class="absolute -top-16 left-8 w-32 h-32 z-10">
            <div class="w-full h-full bg-contain bg-no-repeat bg-center animate-bounce"
                 style="background-image: url('/static/assets/mascots/professor-pixel-transparent.png'); 
                        filter: drop-shadow(0 8px 20px rgba(100, 255, 218, 0.4));
                        animation: professorFloat 4s ease-in-out infinite;">
            </div>
        </div>
        
        <!-- Modal Content -->
        <div class="glass-panel p-8 pt-16 rounded-2xl border-2 border-cyan-400 shadow-2xl"
             style="background: linear-gradient(135deg, rgba(26, 32, 46, 0.95) 0%, rgba(52, 73, 94, 0.95) 100%);
                     backdrop-filter: blur(20px);">
            
            <!-- Close Button -->
            <button onclick="closeProfessorModal()" 
                    class="absolute top-4 right-4 w-8 h-8 rounded-full bg-red-500 bg-opacity-20 border border-red-400 
                           flex items-center justify-center text-red-400 hover:bg-opacity-40 transition-all">
                ‚úï
            </button>
            
            <!-- Speech Bubble Content -->
            <div class="relative">
                <!-- Speech Bubble Tail -->
                <div class="absolute -top-12 left-12 w-0 h-0" 
                     style="border-left: 15px solid transparent;
                            border-right: 15px solid transparent;
                            border-bottom: 15px solid rgba(100, 255, 218, 0.3);"></div>
                
                <!-- Teaching Content -->
                <div class="mb-6">
                    <h3 id="professor-title" class="text-2xl font-bold text-cyan-400 mb-4">
                        üí° Teaching Moment: Variables
                    </h3>
                    
                    <div id="professor-message" class="text-white text-lg leading-relaxed mb-6">
                        <p>Welcome, digital rebel! I see you've discovered how the game stores player health. 
                        Let me explain what's happening in the code...</p>
                    </div>
                </div>
                
                <!-- Code Example -->
                <div id="code-example" class="bg-gray-900 rounded-lg p-4 mb-6 border border-cyan-600">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-cyan-400 text-sm font-mono">üìù Code Breakdown</span>
                        <button onclick="copyCode()" class="text-xs text-cyan-400 hover:text-white">Copy</button>
                    </div>
                    <pre id="code-content" class="text-green-400 font-mono text-sm overflow-x-auto"><code># This variable stores the player's health
player_health = 100

# When the player takes damage
player_health = player_health - 10

# Check if player is still alive
if player_health <= 0:
    game_over = True</code></pre>
                </div>
                
                <!-- Explanation -->
                <div id="explanation" class="bg-blue-900 bg-opacity-30 rounded-lg p-4 mb-6 border border-blue-400">
                    <h4 class="text-blue-400 font-bold mb-2">üß† What's Happening Here?</h4>
                    <div id="explanation-content" class="text-white text-sm leading-relaxed">
                        <p>Variables are like containers that store information. In this case, <code class="text-yellow-300">player_health</code> 
                        is a container holding the number 100. When something changes that number, the game responds accordingly!</p>
                    </div>
                </div>
                
                <!-- Interactive Challenge -->
                <div id="challenge" class="bg-purple-900 bg-opacity-30 rounded-lg p-4 mb-6 border border-purple-400">
                    <h4 class="text-purple-400 font-bold mb-2">üéØ Try It Yourself!</h4>
                    <div id="challenge-content" class="text-white text-sm mb-3">
                        What would happen if we set <code class="text-yellow-300">player_health = 50</code> instead?
                    </div>
                    <div class="space-x-2">
                        <button onclick="submitAnswer('correct')" 
                                class="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-xs">
                            The player starts with half health
                        </button>
                        <button onclick="submitAnswer('wrong')" 
                                class="px-3 py-1 bg-red-600 hover:bg-red-500 rounded text-xs">
                            The game would crash
                        </button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-between items-center">
                    <button onclick="markLearned()" 
                            class="px-4 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-white font-semibold">
                        ‚úÖ Got It!
                    </button>
                    
                    <div class="space-x-2">
                        <button onclick="showMoreInfo()" 
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-white">
                            üìö Learn More
                        </button>
                        <button onclick="continueGame()" 
                                class="px-4 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-white">
                            üéÆ Continue Playing
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@keyframes professorFloat {
    0%, 100% { transform: translateY(0px) rotate(-2deg); }
    50% { transform: translateY(-8px) rotate(2deg); }
}

.glass-panel {
    backdrop-filter: blur(15px);
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(100, 255, 218, 0.3);
}

#professor-pixel-modal code {
    background: rgba(255, 255, 255, 0.1);
    padding: 2px 4px;
    border-radius: 3px;
    font-family: 'JetBrains Mono', monospace;
}
</style>

<script>
// Professor Pixel Modal System
class ProfessorPixelTeacher {
    constructor() {
        this.currentLesson = null;
        this.gameBreakpoints = new Map();
        this.playerProgress = new Set();
    }
    
    // Show teaching modal with specific lesson
    showLesson(lessonId, context = {}) {
        const lessons = this.getLessonData();
        const lesson = lessons[lessonId];
        
        if (!lesson) return;
        
        this.currentLesson = lessonId;
        this.populateModal(lesson, context);
        document.getElementById('professor-pixel-modal').classList.remove('hidden');
        
        // Play notification sound
        if (window.audioManager) {
            audioManager.play('notification');
        }
    }
    
    // Populate modal with lesson content
    populateModal(lesson, context) {
        document.getElementById('professor-title').innerHTML = lesson.title;
        document.getElementById('professor-message').innerHTML = lesson.message;
        document.getElementById('code-content').textContent = lesson.code || '';
        document.getElementById('explanation-content').innerHTML = lesson.explanation;
        document.getElementById('challenge-content').innerHTML = lesson.challenge.question;
        
        // Update challenge buttons if provided
        if (lesson.challenge.options) {
            const challengeDiv = document.getElementById('challenge');
            const buttonsHtml = lesson.challenge.options.map((option, index) => 
                `<button onclick="submitAnswer('${option.correct ? 'correct' : 'wrong'}')" 
                         class="px-3 py-1 ${option.correct ? 'bg-green-600 hover:bg-green-500' : 'bg-red-600 hover:bg-red-500'} rounded text-xs mr-2">
                    ${option.text}
                </button>`
            ).join('');
            
            challengeDiv.querySelector('.space-x-2').innerHTML = buttonsHtml;
        }
    }
    
    // Define lesson data for different programming concepts
    getLessonData() {
        return {
            'variables': {
                title: 'üí° Teaching Moment: Variables',
                message: `<p>Excellent! You've encountered your first variable, <code>player_health</code>. 
                         Variables are like labeled boxes that store information your program needs to remember.</p>`,
                code: `# This variable stores the player's health
player_health = 100

# When the player takes damage
player_health = player_health - 10

# Check if player is still alive
if player_health <= 0:
    game_over = True`,
                explanation: `Variables are containers for storing data. The <code>player_health</code> variable 
                            holds a number that represents how much life the player has left. When events happen 
                            in the game, we can change this value!`,
                challenge: {
                    question: `What would happen if we set <code>player_health = 50</code> at the start?`,
                    options: [
                        { text: 'Player starts with half health', correct: true },
                        { text: 'Game would crash', correct: false },
                        { text: 'Nothing would change', correct: false }
                    ]
                }
            },
            
            'loops': {
                title: 'üîÑ Teaching Moment: Loops',
                message: `<p>You've discovered a loop! This code runs multiple times automatically. 
                         Loops are how we tell the computer to repeat actions without writing the same code over and over.</p>`,
                code: `# This loop runs 60 times per second (game loop)
while game_running:
    # Check for player input
    handle_input()
    
    # Update game objects
    update_enemies()
    
    # Draw everything on screen
    draw_screen()`,
                explanation: `Game loops are essential! They run continuously, updating the game world, 
                            checking for player input, and redrawing the screen. Without loops, 
                            games would only run once and stop!`,
                challenge: {
                    question: `How many times would a <code>for i in range(5):</code> loop run?`,
                    options: [
                        { text: '5 times (0, 1, 2, 3, 4)', correct: true },
                        { text: '4 times', correct: false },
                        { text: 'Forever', correct: false }
                    ]
                }
            },
            
            'functions': {
                title: 'üéØ Teaching Moment: Functions',
                message: `<p>You've found a function! Functions are like recipes - they take ingredients (parameters) 
                         and produce something useful. They help organize code into reusable pieces.</p>`,
                code: `def attack_enemy(damage, enemy):
    enemy.health = enemy.health - damage
    
    if enemy.health <= 0:
        enemy.is_alive = False
        return "Enemy defeated!"
    else:
        return f"Enemy has {enemy.health} health left"

# Using the function
result = attack_enemy(25, goblin)`,
                explanation: `Functions break complex problems into smaller, manageable pieces. Instead of 
                            writing attack code everywhere, we create one <code>attack_enemy</code> function 
                            and use it whenever we need it!`,
                challenge: {
                    question: `What does the <code>return</code> statement do in a function?`,
                    options: [
                        { text: 'Sends a value back to whoever called the function', correct: true },
                        { text: 'Stops the program', correct: false },
                        { text: 'Starts the function over', correct: false }
                    ]
                }
            }
        };
    }
    
    // Register a breakpoint in game code where learning can happen
    registerBreakpoint(gameEvent, lessonId, condition = null) {
        this.gameBreakpoints.set(gameEvent, { lessonId, condition });
    }
    
    // Check if a breakpoint should trigger learning
    checkBreakpoint(gameEvent, gameState = {}) {
        const breakpoint = this.gameBreakpoints.get(gameEvent);
        if (!breakpoint) return false;
        
        // Check if already learned
        if (this.playerProgress.has(breakpoint.lessonId)) return false;
        
        // Check condition if provided
        if (breakpoint.condition && !breakpoint.condition(gameState)) return false;
        
        // Trigger the lesson
        this.showLesson(breakpoint.lessonId, gameState);
        return true;
    }
}

// Initialize global Professor Pixel teacher
const professorPixel = new ProfessorPixelTeacher();

// Modal control functions
function closeProfessorModal() {
    document.getElementById('professor-pixel-modal').classList.add('hidden');
    if (window.audioManager) audioManager.play('click');
}

function submitAnswer(result) {
    const isCorrect = result === 'correct';
    const message = isCorrect ? 
        "üéâ Excellent! You're getting the hang of this!" : 
        "ü§î Not quite right, but that's how we learn! Let me explain...";
    
    // Show feedback
    alert(message);
    
    if (window.audioManager) {
        audioManager.play(isCorrect ? 'success' : 'notification');
    }
}

function markLearned() {
    if (professorPixel.currentLesson) {
        professorPixel.playerProgress.add(professorPixel.currentLesson);
        
        // Save progress to localStorage
        const progress = Array.from(professorPixel.playerProgress);
        localStorage.setItem('professorPixelProgress', JSON.stringify(progress));
        
        alert("üéì Concept learned! This will help you in your coding journey.");
        closeProfessorModal();
    }
}

function showMoreInfo() {
    // Could open external documentation or deeper explanation
    window.open('https://docs.python.org/3/tutorial/', '_blank');
}

function continueGame() {
    closeProfessorModal();
    // Resume game logic
}

function copyCode() {
    const code = document.getElementById('code-content').textContent;
    navigator.clipboard.writeText(code).then(() => {
        alert('üìã Code copied to clipboard!');
    });
}

// Load saved progress
document.addEventListener('DOMContentLoaded', function() {
    const saved = localStorage.getItem('professorPixelProgress');
    if (saved) {
        const progress = JSON.parse(saved);
        progress.forEach(lesson => professorPixel.playerProgress.add(lesson));
    }
    
    // Example breakpoint registrations for a pygame RPG
    professorPixel.registerBreakpoint('player_takes_damage', 'variables');
    professorPixel.registerBreakpoint('game_loop_start', 'loops');
    professorPixel.registerBreakpoint('attack_function_called', 'functions');
});

// Expose global functions for game integration
window.professorPixel = professorPixel;
window.showProfessorLesson = (lessonId, context) => professorPixel.showLesson(lessonId, context);
window.checkGameBreakpoint = (event, state) => professorPixel.checkBreakpoint(event, state);
</script>